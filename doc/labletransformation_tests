#lang racket

(require "../src/Labeltransformation.rkt" redex rackunit)


(judgment-holds
 (>
  (((port 1) ((1 4 5)(1 6))))
  ((aSurelySafeVariable ((4 5) (6))))
  ((1))
  (out ((port 1) < aSurelySafeVariable)) : Γ C)
 C)
; A potentially secret value is written to an output port. This must trigger an dynamic check.
(test-equal
 (judgment-holds
  (>
   (((port 1) ((7))))
   ((aPotentiallyTooSecretVariable ((4 5) (6))))
   ((2))
   (out ((port 1) < aPotentiallyTooSecretVariable)) : Γ C)
  C)
 '((skip
    then
    (if (((pc ∪ *aPotentiallyTooSecretVariable) ⊆ (1 2 3)))
        ((out ((port 1) < aPotentiallyTooSecretVariable)))
        else
        (halt)))))